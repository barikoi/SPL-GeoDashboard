# .husky/pre-commit
# Get the branch name
BRANCH_NAME=$(git rev-parse --abbrev-ref HEAD)

# This script runs linting, type checking, and builds before allowing a commit.
echo 'ğŸ› ï¸  Preparing to commit: Running linting, type checking, test coverage, and build'

# Run ESLint for linting
echo "ğŸ” Running ESLint..."
npm run lint ||
(
  echo 'âŒ ESLint check failed. Please fix the linting issues before committing.'
  exit 1
)

# # Run test coverage for dev and staging branch
# if [ "$BRANCH_NAME" = "mcdonalds" ]; then
#   echo "ğŸ§ª Running test coverage..."
#   npm run test:coverage ||
#   (
#     echo 'âŒ Test coverage failed. Please ensure all tests pass and coverage thresholds are met before committing.'
#     exit 1
#   )
# fi

# Run build only for main branch
if [ "$BRANCH_NAME" = "mcdonalds" ]; then
  echo "ğŸ—ï¸  Running build for mcdonalds branch..."
  npm run build ||
  (
    echo 'âŒ Build failed. Please ensure the build process completes successfully before committing.'
    exit 1
  )
fi

# All checks passed, allow the commit
echo 'âœ… All pre-commit checks passed. You may now commit your changes.'